{% extends "base.html" %}
{% load static %}
{% block name %}
<title>ToDo List - TaskMate</title>
{% endblock %}

{% block title %}
<div class="container">
  <h1 class="text-center">
    <span style="color: black;">Task</span><span style="color: purple;">Mate</span>
  </h1>
</div>
{% endblock %}

{% block content %}
<div style="text-align: center;">
  <strong>{{ variable_key }}</strong>
</div>
{% for message in messages %}
<div class="alert alert-info alert-dismissible fade show d-flex justify-content-between align-items-center" role="alert">
    <span>{{ message }}</span>
    <button type="button" class="btn-close ms-2" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
    <!-- Add Task Form -->
<form method="post" class="row justify-content-center align-items-center g-2" style="text-align:center;">
  {% csrf_token %}
  <!-- Label -->
  <div class="col-auto">
    <label for="taskInput" class="col-form-label fw-bold" style="font-size: 0.95rem;">Add New Task</label>
  </div>
  <!-- Input -->
  <div class="col-6">
    <input type="text" 
           id="taskInput"
           name="title" 
           class="form-control"
           style="min-width: 300px;"
           placeholder="Enter Task Name" 
           required>
  </div>
  <!-- Button -->
  <div class="col-auto">
    <button type="submit" class="btn btn-primary btn-sm">    Add </button>
  </div>
</form>
</br>
<!-- Task List (Responsive for Vertical/Small Screens) -->
<div class="table-responsive">
  <table class="table table-striped text-center align-middle">
    <thead class="d-none d-lg-table-header-group">
      <tr>
        <th>TaskName</th>
        <th>Status</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>
      {% for obj in all_tasks %}
        <!-- Desktop Row -->
        <tr class="d-none d-lg-table-row">
          {% if obj.completed %}
            <td><del>{{ obj.title }}</del></td>
            <td>
              <a href="{% url 'task_pending' obj.id %}">
              <button type="button" class="btn btn-success btn-sm py-1 px-2" style="font-size:0.80rem; min-width:70px; max-width:90px;">Completed</button>
              </a>
            </td>
            {% else %}
            <td>{{ obj.title }}</td>
            <td>
              <a href="{% url 'task_done' obj.id %}">
              <button type="button" class="btn btn-warning btn-sm py-1 px-2" style="font-size:0.80rem; min-width:70px; max-width:90px;">Pending</button>
              </a>
            </td>
            {% endif %}
            <td>
            <a href="{% url 'edit_task' obj.id %}">
              <button type="button" class="btn btn-secondary btn-sm py-1 px-2" style="font-size:0.80rem; min-width:60px; max-width:80px;">Edit</button>
            </a>
            </td>
            <td>
            <a href="{% url 'delete_task' obj.id %}">
              <button type="button" class="btn btn-danger btn-sm py-1 px-2" style="font-size:0.80rem; min-width:60px; max-width:80px;">Delete</button>
            </a>
            </td>
          </tr>
          <!-- Mobile Card -->
          <tr class="d-table-row d-lg-none">
            <td colspan="4">
            <div class="card mb-2">
              <div class="card-body p-2">
              <h5 class="card-title mb-2" style="font-size:1.1rem;">
                {% if obj.completed %}
                <del>{{ obj.title }}</del>
                {% else %}
                {{ obj.title }}
                {% endif %}
              </h5>
              <div class="d-flex flex-wrap gap-2 justify-content-center">
                {% if obj.completed %}
                <a href="{% url 'task_pending' obj.id %}">
                  <button type="button" class="btn btn-success btn-sm py-1 px-2" style="font-size:0.85rem;">Completed</button>
                </a>
                {% else %}
                <a href="{% url 'task_done' obj.id %}">
                  <button type="button" class="btn btn-warning btn-sm py-1 px-2" style="font-size:0.85rem;">Pending</button>
                </a>
                {% endif %}
                <a href="{% url 'edit_task' obj.id %}">
                <button type="button" class="btn btn-secondary btn-sm py-1 px-2" style="font-size:0.85rem;">Edit</button>
                </a>
                <a href="{% url 'delete_task' obj.id %}">
                <button type="button" class="btn btn-danger btn-sm py-1 px-2" style="font-size:0.85rem;">Delete</button>
                  </a>
                </div>
              </div>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<!-- Pagination controls -->
<nav aria-label="...">
  <ul class="pagination justify-content-center">
    <li class="page-item"><a href="?page=1" class="page-link"><<</a></li>
    {% if all_tasks.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ all_tasks.previous_page_number }}">{{ all_tasks.previous_page_number }}</a></li>
    {% endif %}

    <li class="page-item"><a class="page-link" href="#" aria-current="page">{{ all_tasks.number }}</a></li>

    {% if all_tasks.has_next %}
     <li class="page-item"><a class="page-link" href="?page={{ all_tasks.next_page_number }}">{{ all_tasks.next_page_number }}</a></li>
    {% endif %}
    <li class="page-item"><a class="page-link" href="?page={{ all_tasks.paginator.num_pages }}">>></a></li>
  </ul>
</nav>
{% endblock %}

{% block staticimage %}
</br>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12 d-flex justify-content-center align-items-center">
                <!-- Unsplash sample image -->
                <img src="{% static 'images/workshop-2Kqhw3qST0o-unsplash.jpg' %}" alt="Sample Unsplash Image" class="img-fluid" style="max-width: 100%; height: auto;">
            </div>
        </div>
    </div>
{% endblock %}
